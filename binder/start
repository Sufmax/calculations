#!/bin/bash

# Installer Blender 4.2 LTS si pas déjà installé
if [ ! -f "$HOME/blender/blender" ]; then
    echo "Installation de Blender 4.2.17 LTS..."
    wget -q https://download.blender.org/release/Blender4.2/blender-4.2.17-linux-x64.tar.xz
    mkdir -p "$HOME/blender"
    tar -xf blender-4.2.17-linux-x64.tar.xz -C "$HOME/blender" --strip-components=1
    rm blender-4.2.17-linux-x64.tar.xz
fi

export PATH="$HOME/blender:$PATH"

# Vérifier que Blender est prêt
until blender --version > /dev/null 2>&1; do
    echo "Attente de Blender..."
    sleep 1
done

echo "Blender installé : $(blender --version | head -1)"

# Lancer ton script en arrière-plan
cd ${HOME}/programs
python set_id.py
python vm_main.py &

# Lancer Jupyter
exec "$@"
